{"remainingRequest":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js??ref--0-1!/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js??ref--0-2!/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/erwerbspensumView/erwerbspensumView.ts","cacheIdentifier":"cache-loader:1.1.0 test","dependencies":[{"path":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/erwerbspensumView/erwerbspensumView.ts","mtime":1518612532798},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/cache-loader/dist/cjs.js","mtime":1507514019000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/thread-loader/dist/cjs.js","mtime":1507523420000},{"path":"/home/imanol/projects/ebegu/ebegu-web/node_modules/ts-loader/index.js","mtime":1508488471000}],"contextDependencies":[],"result":["\"use strict\";\n/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar abstractGesuchView_1 = require(\"../abstractGesuchView\");\nvar TSErwerbspensumContainer_1 = require(\"../../../models/TSErwerbspensumContainer\");\nvar TSTaetigkeit_1 = require(\"../../../models/enums/TSTaetigkeit\");\nvar TSZuschlagsgrund_1 = require(\"../../../models/enums/TSZuschlagsgrund\");\nvar TSErwerbspensum_1 = require(\"../../../models/TSErwerbspensum\");\nvar TSRoleUtil_1 = require(\"../../../utils/TSRoleUtil\");\nvar TSWizardStepName_1 = require(\"../../../models/enums/TSWizardStepName\");\nvar TSEbeguParameterKey_1 = require(\"../../../models/enums/TSEbeguParameterKey\");\nvar TSCacheTyp_1 = require(\"../../../models/enums/TSCacheTyp\");\nvar template = require('./erwerbspensumView.html');\nrequire('./erwerbspensumView.less');\nvar ErwerbspensumViewComponentConfig = /** @class */ (function () {\n    function ErwerbspensumViewComponentConfig() {\n        this.transclude = false;\n        this.bindings = {};\n        this.template = template;\n        this.controller = ErwerbspensumViewController;\n        this.controllerAs = 'vm';\n    }\n    return ErwerbspensumViewComponentConfig;\n}());\nexports.ErwerbspensumViewComponentConfig = ErwerbspensumViewComponentConfig;\nvar ErwerbspensumViewController = /** @class */ (function (_super) {\n    __extends(ErwerbspensumViewController, _super);\n    /* @ngInject */\n    function ErwerbspensumViewController($stateParams, gesuchModelManager, berechnungsManager, CONSTANTS, $scope, errorService, authServiceRS, wizardStepManager, $q, $translate, ebeguParameterRS, globalCacheService, $timeout) {\n        var _this = _super.call(this, gesuchModelManager, berechnungsManager, wizardStepManager, $scope, TSWizardStepName_1.TSWizardStepName.ERWERBSPENSUM, $timeout) || this;\n        _this.CONSTANTS = CONSTANTS;\n        _this.errorService = errorService;\n        _this.authServiceRS = authServiceRS;\n        _this.$q = $q;\n        _this.$translate = $translate;\n        _this.ebeguParameterRS = ebeguParameterRS;\n        _this.globalCacheService = globalCacheService;\n        _this.maxZuschlagsprozent = 100;\n        _this.patternPercentage = _this.CONSTANTS.PATTERN_PERCENTAGE;\n        _this.gesuchModelManager.setGesuchstellerNumber(parseInt($stateParams.gesuchstellerNumber));\n        _this.gesuchsteller = _this.gesuchModelManager.getStammdatenToWorkWith();\n        if (_this.gesuchsteller) {\n            if ($stateParams.erwerbspensumNum) {\n                var ewpNum = parseInt($stateParams.erwerbspensumNum) | 0;\n                _this.model = angular.copy(_this.gesuchsteller.erwerbspensenContainer[ewpNum]);\n            }\n            else {\n                //wenn erwerbspensum nummer nicht definiert ist heisst dass, das wir ein neues erstellen sollten\n                _this.model = _this.initEmptyEwpContainer();\n            }\n        }\n        else {\n            errorService.addMesageAsError('Unerwarteter Zustand: Gesuchsteller unbekannt');\n            console.log('kein gesuchsteller gefunden');\n        }\n        ebeguParameterRS.getEbeguParameterByGesuchsperiodeCached(_this.gesuchModelManager.getGesuchsperiode().id, _this.globalCacheService.getCache(TSCacheTyp_1.TSCacheTyp.EBEGU_PARAMETER)).then(function (response) {\n            for (var i = 0; i < response.length; i++) {\n                if (response[i].name === TSEbeguParameterKey_1.TSEbeguParameterKey.PARAM_MAXIMALER_ZUSCHLAG_ERWERBSPENSUM) {\n                    // max Wert für Zuschlag Erwerbspensum\n                    _this.maxZuschlagsprozent = Number(response[i].value);\n                }\n            }\n        });\n        return _this;\n    }\n    ErwerbspensumViewController.prototype.getTaetigkeitenList = function () {\n        return TSTaetigkeit_1.getTSTaetigkeit();\n    };\n    ErwerbspensumViewController.prototype.getZuschlagsgrundList = function () {\n        if (this.authServiceRS.isOneOfRoles(TSRoleUtil_1.TSRoleUtil.getGesuchstellerOnlyRoles())) {\n            return TSZuschlagsgrund_1.getTSZuschlagsgruendeForGS();\n        }\n        else {\n            return TSZuschlagsgrund_1.getTSZuschlagsgrunde();\n        }\n    };\n    /**\n     * Beim speichern wird geschaut ob Zuschlagsgrund noetig ist, wenn nicht zuruecksetzten\n     * @param erwerbspensum\n     */\n    ErwerbspensumViewController.prototype.maybeResetZuschlagsgrund = function (erwerbspensum) {\n        if (erwerbspensum && !erwerbspensum.erwerbspensumJA.zuschlagZuErwerbspensum) {\n            erwerbspensum.erwerbspensumJA.zuschlagsprozent = undefined;\n            erwerbspensum.erwerbspensumJA.zuschlagsgrund = undefined;\n        }\n    };\n    ErwerbspensumViewController.prototype.save = function () {\n        if (this.isGesuchValid()) {\n            if (!this.form.$dirty) {\n                // If there are no changes in form we don't need anything to update on Server and we could return the\n                // promise immediately\n                return this.$q.when(this.model);\n            }\n            this.maybeResetZuschlagsgrund(this.model);\n            this.errorService.clearAll();\n            return this.gesuchModelManager.saveErwerbspensum(this.gesuchsteller, this.model);\n        }\n        return undefined;\n    };\n    ErwerbspensumViewController.prototype.cancel = function () {\n        this.form.$setPristine();\n    };\n    ErwerbspensumViewController.prototype.initEmptyEwpContainer = function () {\n        var ewp = new TSErwerbspensum_1.default();\n        var ewpContainer = new TSErwerbspensumContainer_1.default();\n        ewpContainer.erwerbspensumJA = ewp;\n        return ewpContainer;\n    };\n    ErwerbspensumViewController.prototype.viewZuschlag = function () {\n        return this.model.erwerbspensumJA.taetigkeit === TSTaetigkeit_1.TSTaetigkeit.ANGESTELLT ||\n            this.model.erwerbspensumJA.taetigkeit === TSTaetigkeit_1.TSTaetigkeit.AUSBILDUNG ||\n            this.model.erwerbspensumJA.taetigkeit === TSTaetigkeit_1.TSTaetigkeit.SELBSTAENDIG;\n    };\n    ErwerbspensumViewController.prototype.taetigkeitChanged = function () {\n        if (!this.viewZuschlag()) {\n            this.model.erwerbspensumJA.zuschlagZuErwerbspensum = false;\n            this.model.erwerbspensumJA.zuschlagsprozent = undefined;\n            this.model.erwerbspensumJA.zuschlagsgrund = undefined;\n        }\n    };\n    ErwerbspensumViewController.prototype.erwerbspensumDisabled = function () {\n        // Disabled wenn Mutation, ausser bei Bearbeiter Jugendamt oder Schulamt\n        return this.model.erwerbspensumJA.vorgaengerId && !this.authServiceRS.isOneOfRoles(TSRoleUtil_1.TSRoleUtil.getAdministratorOrAmtRole());\n    };\n    ErwerbspensumViewController.prototype.getTextZuschlagErwerbspensumKorrekturJA = function () {\n        if (this.model.erwerbspensumGS && this.model.erwerbspensumGS.zuschlagZuErwerbspensum === true) {\n            var ewp = this.model.erwerbspensumGS;\n            var grundText = this.$translate.instant(ewp.zuschlagsgrund.toString());\n            return this.$translate.instant('JA_KORREKTUR_ZUSCHLAG_ERWERBSPENSUM', {\n                zuschlagsgrund: grundText,\n                zuschlagsprozent: ewp.zuschlagsprozent\n            });\n        }\n        else {\n            return this.$translate.instant('LABEL_KEINE_ANGABE');\n        }\n    };\n    ErwerbspensumViewController.prototype.getZuschlagHelpText = function () {\n        return this.$translate.instant('ZUSCHLAGSGRUND_HELP', {\n            maxzuschlag: this.maxZuschlagsprozent\n        });\n    };\n    ErwerbspensumViewController.$inject = ['$stateParams', 'GesuchModelManager', 'BerechnungsManager',\n        'CONSTANTS', '$scope', 'ErrorService', 'AuthServiceRS', 'WizardStepManager', '$q', '$translate', 'EbeguParameterRS', 'GlobalCacheService', '$timeout'];\n    return ErwerbspensumViewController;\n}(abstractGesuchView_1.default));\nexports.ErwerbspensumViewController = ErwerbspensumViewController;\n",{"version":3,"file":"/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/erwerbspensumView/erwerbspensumView.ts","sourceRoot":"","sources":["/home/imanol/projects/ebegu/ebegu-web/src/gesuch/component/erwerbspensumView/erwerbspensumView.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Ki-Tax: System for the management of external childcare subsidies\n * Copyright (C) 2017 City of Bern Switzerland\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport {IComponentOptions, IPromise, IQService, IScope, ITimeoutService} from 'angular';\nimport AbstractGesuchViewController from '../abstractGesuchView';\nimport GesuchModelManager from '../../service/gesuchModelManager';\nimport {IErwerbspensumStateParams} from '../../gesuch.route';\nimport TSErwerbspensumContainer from '../../../models/TSErwerbspensumContainer';\nimport {getTSTaetigkeit, TSTaetigkeit} from '../../../models/enums/TSTaetigkeit';\nimport {getTSZuschlagsgruendeForGS, getTSZuschlagsgrunde, TSZuschlagsgrund} from '../../../models/enums/TSZuschlagsgrund';\nimport TSErwerbspensum from '../../../models/TSErwerbspensum';\nimport BerechnungsManager from '../../service/berechnungsManager';\nimport ErrorService from '../../../core/errors/service/ErrorService';\nimport AuthServiceRS from '../../../authentication/service/AuthServiceRS.rest';\nimport WizardStepManager from '../../service/wizardStepManager';\nimport {TSRoleUtil} from '../../../utils/TSRoleUtil';\nimport TSGesuchstellerContainer from '../../../models/TSGesuchstellerContainer';\nimport {TSWizardStepName} from '../../../models/enums/TSWizardStepName';\nimport TSEbeguParameter from '../../../models/TSEbeguParameter';\nimport {TSEbeguParameterKey} from '../../../models/enums/TSEbeguParameterKey';\nimport GlobalCacheService from '../../service/globalCacheService';\nimport {EbeguParameterRS} from '../../../admin/service/ebeguParameterRS.rest';\nimport {TSCacheTyp} from '../../../models/enums/TSCacheTyp';\nimport ITranslateService = angular.translate.ITranslateService;\n\nlet template: string = require('./erwerbspensumView.html');\nrequire('./erwerbspensumView.less');\n\nexport class ErwerbspensumViewComponentConfig implements IComponentOptions {\n    transclude: boolean;\n    bindings: any;\n    template: string;\n    controller: any;\n    controllerAs: string;\n\n    constructor() {\n        this.transclude = false;\n        this.bindings = {};\n        this.template = template;\n        this.controller = ErwerbspensumViewController;\n        this.controllerAs = 'vm';\n    }\n}\n\nexport class ErwerbspensumViewController extends AbstractGesuchViewController<TSErwerbspensumContainer> {\n\n    gesuchsteller: TSGesuchstellerContainer;\n    patternPercentage: string;\n    maxZuschlagsprozent: number = 100;\n\n    static $inject: string[] = ['$stateParams', 'GesuchModelManager', 'BerechnungsManager',\n        'CONSTANTS', '$scope', 'ErrorService', 'AuthServiceRS', 'WizardStepManager', '$q', '$translate', 'EbeguParameterRS', 'GlobalCacheService', '$timeout'];\n\n    /* @ngInject */\n    constructor($stateParams: IErwerbspensumStateParams, gesuchModelManager: GesuchModelManager,\n                berechnungsManager: BerechnungsManager, private CONSTANTS: any, $scope: IScope, private errorService: ErrorService,\n                private authServiceRS: AuthServiceRS, wizardStepManager: WizardStepManager, private $q: IQService,\n                private $translate: ITranslateService, private ebeguParameterRS: EbeguParameterRS, private globalCacheService: GlobalCacheService,\n                $timeout: ITimeoutService) {\n        super(gesuchModelManager, berechnungsManager, wizardStepManager, $scope, TSWizardStepName.ERWERBSPENSUM, $timeout);\n        this.patternPercentage = this.CONSTANTS.PATTERN_PERCENTAGE;\n        this.gesuchModelManager.setGesuchstellerNumber(parseInt($stateParams.gesuchstellerNumber));\n        this.gesuchsteller = this.gesuchModelManager.getStammdatenToWorkWith();\n        if (this.gesuchsteller) {\n            if ($stateParams.erwerbspensumNum) {\n                let ewpNum = parseInt($stateParams.erwerbspensumNum) | 0;\n                this.model = angular.copy(this.gesuchsteller.erwerbspensenContainer[ewpNum]);\n            } else {\n                //wenn erwerbspensum nummer nicht definiert ist heisst dass, das wir ein neues erstellen sollten\n                this.model = this.initEmptyEwpContainer();\n            }\n        } else {\n            errorService.addMesageAsError('Unerwarteter Zustand: Gesuchsteller unbekannt');\n            console.log('kein gesuchsteller gefunden');\n        }\n        ebeguParameterRS.getEbeguParameterByGesuchsperiodeCached(\n            this.gesuchModelManager.getGesuchsperiode().id,\n            this.globalCacheService.getCache(TSCacheTyp.EBEGU_PARAMETER)).then((response: TSEbeguParameter[]) => {\n            for (let i = 0; i < response.length; i++) {\n                if (response[i].name === TSEbeguParameterKey.PARAM_MAXIMALER_ZUSCHLAG_ERWERBSPENSUM) {\n                    // max Wert für Zuschlag Erwerbspensum\n                    this.maxZuschlagsprozent = Number(response[i].value);\n                }\n            }\n        });\n    }\n\n    getTaetigkeitenList(): Array<TSTaetigkeit> {\n        return getTSTaetigkeit();\n    }\n\n    getZuschlagsgrundList(): Array<TSZuschlagsgrund> {\n        if (this.authServiceRS.isOneOfRoles(TSRoleUtil.getGesuchstellerOnlyRoles())) {\n            return getTSZuschlagsgruendeForGS();\n        } else {\n            return getTSZuschlagsgrunde();\n        }\n    }\n\n    /**\n     * Beim speichern wird geschaut ob Zuschlagsgrund noetig ist, wenn nicht zuruecksetzten\n     * @param erwerbspensum\n     */\n    private maybeResetZuschlagsgrund(erwerbspensum: TSErwerbspensumContainer) {\n        if (erwerbspensum && !erwerbspensum.erwerbspensumJA.zuschlagZuErwerbspensum) {\n            erwerbspensum.erwerbspensumJA.zuschlagsprozent = undefined;\n            erwerbspensum.erwerbspensumJA.zuschlagsgrund = undefined;\n        }\n    }\n\n    save(): IPromise<any> {\n        if (this.isGesuchValid()) {\n\n            if (!this.form.$dirty) {\n                // If there are no changes in form we don't need anything to update on Server and we could return the\n                // promise immediately\n                return this.$q.when(this.model);\n            }\n            this.maybeResetZuschlagsgrund(this.model);\n            this.errorService.clearAll();\n            return this.gesuchModelManager.saveErwerbspensum(this.gesuchsteller, this.model);\n        }\n        return undefined;\n    }\n\n    cancel() {\n        this.form.$setPristine();\n    }\n\n\n    private initEmptyEwpContainer(): TSErwerbspensumContainer {\n        let ewp = new TSErwerbspensum();\n        let ewpContainer = new TSErwerbspensumContainer();\n        ewpContainer.erwerbspensumJA = ewp;\n        return ewpContainer;\n\n    }\n\n    viewZuschlag(): boolean {\n        return this.model.erwerbspensumJA.taetigkeit === TSTaetigkeit.ANGESTELLT ||\n            this.model.erwerbspensumJA.taetigkeit === TSTaetigkeit.AUSBILDUNG ||\n            this.model.erwerbspensumJA.taetigkeit === TSTaetigkeit.SELBSTAENDIG;\n    }\n\n    taetigkeitChanged() {\n        if (!this.viewZuschlag()) {\n            this.model.erwerbspensumJA.zuschlagZuErwerbspensum = false;\n            this.model.erwerbspensumJA.zuschlagsprozent = undefined;\n            this.model.erwerbspensumJA.zuschlagsgrund = undefined;\n        }\n    }\n\n    erwerbspensumDisabled(): boolean {\n        // Disabled wenn Mutation, ausser bei Bearbeiter Jugendamt oder Schulamt\n        return this.model.erwerbspensumJA.vorgaengerId && !this.authServiceRS.isOneOfRoles(TSRoleUtil.getAdministratorOrAmtRole());\n    }\n\n    public getTextZuschlagErwerbspensumKorrekturJA(): string {\n        if (this.model.erwerbspensumGS && this.model.erwerbspensumGS.zuschlagZuErwerbspensum === true) {\n            let ewp: TSErwerbspensum = this.model.erwerbspensumGS;\n            let grundText = this.$translate.instant(ewp.zuschlagsgrund.toString());\n            return this.$translate.instant('JA_KORREKTUR_ZUSCHLAG_ERWERBSPENSUM', {\n                zuschlagsgrund: grundText,\n                zuschlagsprozent: ewp.zuschlagsprozent\n            });\n        } else {\n            return this.$translate.instant('LABEL_KEINE_ANGABE');\n        }\n    }\n\n    public getZuschlagHelpText(): string {\n        return this.$translate.instant('ZUSCHLAGSGRUND_HELP', {\n            maxzuschlag: this.maxZuschlagsprozent\n        });\n    }\n\n}\n"]}]}